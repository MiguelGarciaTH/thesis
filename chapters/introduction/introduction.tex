\chapter{Introduction}
\label{chap:introduction}

\section{Context and Motivation}
\gls{bft}\footnote{In this thesis we interchange Byzantine fault tolerance (subject) with Byzantine fault-tolerant (adjetive) using the same acronym BFT for both.} is a well-established area of research that aims to guarantee safety on replicated systems even in the presence of some (Byzantine) faulty nodes.
In a nutshell, \gls{bft} protocols guarantee that replicas agree on the order of the message execution, and thus, working as a replicated state machine.
This holds even if a subpart $f$ out of $n$ is faulty, then there is always a sufficient number of correct nodes to execute correclty.
Although not explicit, this assumption leverages on the strict condition that the nodes (must) fail independly.
Otherwise, compromising $f+1$ is virtually the same than compromising $f$.


\gls{bft} was first proposed in 1982 by Lamport~\etal{}~\cite{Lamport:1982}, but it only as awaken the distributed systems research community to its relevancy in 1999 due to Castro and Liskov's Practical \gls{bft}~\cite{Castro:1999}. 
In the last twenty years of active research on \gls{bft} replication, there were made great advances on the performance (e.g.,~\cite{Kotla:2010,Aublin:2015,Behl:2015}), use of resources (e.g.,~\cite{Yin:2003,Wood:2011,Veronese:2013,Liu:2016,Behl:2017}), and robustness (e.g.,~\cite{Amir:2011,Bessani:2014,Clement:2009b}) of \gls{bft} systems.
However, \gls{bft} in general and these works in particular, assume, either implicitly or explicitly, that the replica nodes fail independtly. 
This assumption guarantees that the fault threshold is extended in time as it is more time consuming to compromise different replicas than compromise replicas that are equal, thus share the same weaknesses.
Nevertheless, a few works rely on some orthogonal mechanism (e.g.,~\cite{Roeder:2010,Chen:1995}) to avoid these common weaknesses, or rule out the possibility of malicious failures from their ystem models.
Moreover, a few works have implemented and experimented with such mechanisms~\cite{Rodrigues:2001,Roeder:2010,Amir:2011}, but in a very limited way.
Even if considering an initial set of $n$ diverse replicas (i.e., to the assumption), long-running services need to be cleaned from possible failures and intrusions.
A few works on the proactive recovery of \gls{bft} systems~\cite{Castro:2002,Sousa:2010,Roeder:2010,Platania:2014,Distler:2011} periodically restart their replicas to clean undetected faulty states introduced by a stealth attacker. 
However, a common limitation of these works is that they assume that these weaknesses will be cleaned after the recovery.
In practice, this will not happen unless the replica changes its software (e.g., via the previously described techniques) after its recovery.



In practice, diversity has shown that it is a fundamental building block of dependable services.
For example, in avionics~\cite{Yeh:2004}, military systems~\cite{rhimes}, and even in recent blockchain platforms such as Ethereum\footnote{\url{https://www.reddit.com/r/ethereum/comments/55s085/geth_nodes_under_attack_again_we_are_actively/}} (three essential applications of \gls{bft}), and the \gls{dns}~\cite{Shue:2013}.~\footnote{\url{https://secure64.com/dns-diversity/}}. 
AUMENTAR A EXPLICACAO DE CADA UM 


Despite the maturity of \gls{bft} solutions, no one addressed the challenge of building dependable \gls{bft} systems that consider evidence supported decisions on diversity and 



\section{Objectives and Contributions}

DEFINE THE GENERIC OBJECTIVES OF THE THESIS 

\subsection{Evidence for Supporting Diversity}% Diversity Study on Off-the-Shelf Operating Systems}
The current solutions that vouch for diversity as a way to guarantee failure independence, either lack of supporting evidence, or use evidence that is limited to some extent.
Therefore, some of the results may provide false conclusions.
We identify a need for finding \emph{accurate} sources for supporting sound evidence of the benefits diversity as a dependable mechanism.


The results achieved during the MSc thesis encouraged us to extend the work on \gls{ots} \glspl{os} common vulnerabilities~\cite{Garcia:2012}.
In this extension, we devised three manual strategies for selecting diverse software components to minimize the incidence of common vulnerabilities in replicated systems.
Moreover, we observed that using different \gls{os} releases of the same \gls{os} are enough to warrant its adoption as a more straightforward, less complicated, more manageable configuration for replicated systems.

\begin{enumerate}
\item[1.] \textbf{Analysis of operating system diversity for intrusion tolerance}, Miguel Garcia, Alysson Bessani, Ilir Gashi Nuno Neves, and Rafael Obelheiro, in \emph{Software: Practice and Experience, 2014}~\cite{Garcia:2014}.
\end{enumerate}



\subsection{Applying Diversity on BFT Systems}
%{\system, a Diversity and Recovery Manager for BFT systems}

A few works consider the diversity of replicas as a way to achieve such failure independence, however, it is mostly taken for granted.
For example, by using memory randomization techniques~\cite{Roeder:2010} or different \glspl{os}~\cite{Rodrigues:2001,Junqueira:2005} without providing evidence for such independence. 
Moreover, it has been shown that memory randomization does not suffice to impede common failures to occurring~\cite{Snow:2013,Bittau:2014}, and that although diversity promotes fault independence to some extent, it does not avoid utterly different \glspl{os} from sharing vulnerabilities~\cite{Garcia:2014}.


Therefore, some of the results may provide false conclusions.
We identify a need for finding \emph{accurate} sources for supporting sound evidence of the benefits diversity as a dependable mechanism.

A few works use automatic and artificial diversity (e.g.,~\cite{Roeder:2010,Amir:2011}). 
However, they lack evidence to support the failure of independence through diversity. 
Moreover, some studies show that these techniques fail to provide real diversity~\cite{Snow:2013,Bittau:2014}. 
Additionally, the existent systems that implement time-triggered recoveries assume that it takes the same time to compromise each replica, by assuming that vuleranbilies are all the same. 
This assumption is unrealistic, especially when the diversity of replicas is considered~\cite{Nayak:2014}. 
Therefore, it is required tailored methods to evaluate the risk of a replicated system becoming compromised.


The few works have implemented and experimented with such mechanisms~\cite{Rodrigues:2001,Roeder:2010,Amir:2011}. 
However, despite the lack of evidence for supporting the diversity claim, they lack mechanisms that can make practical \gls{bft} systems using diversity in a continuous mode operation (i.e., with recoveries).  
Thus, reducing the costs typically associated with the management of such complex systems which deemed them as practical.


The problem is addressed from both a theoretical and practical perspective.


We address the problems of \emph{finding evidence for supporting diversity}, \emph{manage diversity in a dependable way}, and \emph{supporting diversity mechanism} in the thesis main contribution.
We use different \gls{osint} data sources to build a complete knowledge base about the possible vulnerabilities, exploits, and patches related to the systems of interest. 
Moreover, this data is used to create clusters of similar vulnerabilities, which potentially can be affected by (variations of) the same exploit. 
These clusters and the other collected data are used to assess the risk of the \gls{bft} system becoming compromised due to common vulnerabilities.
Once the risk increases, the system replaces the potentially vulnerable replica by another one, to maximize the failure independence of the replicated service.
The solution continuously collects data from the online sources and monitors the risk of the \gls{bft} in such a way that removes the human from the loop.
We developed these contributions in a solution named \system, and it is the first system that manages \gls{bft} replicated systems (e.g., \sieveq) in a dependable and automatic way.
\system experimental evaluation shows that its strategy reduces the number of executions where the system becomes compromised and that our prototype supports the execution of full-fledged \gls{bft} systems in diverse configurations with 17 \gls{os} versions, reaching a performance close to a homogeneous bare metal setup. 


Patches take time to apply~\cite{Frei:2010}

MAking exploit from patches that were not yet released!!!\cite{Brumley:2008}
THE NEED FOR AUTOMATIC PATCHING~\cite{Nappa:2015} --shared code, one takes the patch and the other no


The contributions of this work resulted in the following publications:

\begin{enumerate}

\item[2.] \textbf{DIVERSYS: DIVErse Rejuvenation SYStem}, Miguel Garcia, Nuno Neves, and  Alysson Bessani in the \emph{Simp\'{o}sio Nacional de Inform\'{a}tica (INFORUM), 2012~\cite{Garcia:2012b}}.


\item[3.] \textbf{Towards an Execution Environment for Intrusion-Tolerant Systems}, Miguel Garcia, Alysson Bessani, and Nuno Neves, Poster session in the \emph{European Conference on Computer Systems (EuroSys), 2016}~\cite{Garcia:2016b}.


\item[4.] \textbf{\system: Automatic Management of Diversity in BFT Systems}, Miguel Garcia, Alysson Bessani, and Nuno Neves -- \emph{Submitted for publication}.

\end{enumerate}


\subsection{BFT Multi-layer Resiliency} 
Most generic firewall solutions suffer from two inherent problems: 
First, they have vulnerabilities as any other system, and as a consequence, they can also be the target of advanced attacks. 
For example, the \gls{nvd}~\cite{nvd} shows that there have been many security issues in commonly used firewalls. 
\gls{nvd}'s reports present the following numbers of security issues between 2010 and 2015: 157 for the Cisco Adaptive Security Appliance; 109 in Juniper Networks solutions; 29 for the Sonicwall firewall; and 24 related to iptables/netfilter. 
Common protection solutions often have been the target of malicious actions as part of a wider scale attack (e.g., anti-virus software~\cite{Chauhan:2011}, \gls{ids}~\cite{Anderson:2001} or firewalls~\cite{Kamara:2003,Surisetty:2010,cisco1,cisco2}).
Second, firewalls are typically a single point of failure, which means that when they crash, the ability of the protected system to communicate may be compromised, at least momentarily.
Therefore, ensuring the correct operation of the firewall under a wide range of failure scenarios becomes imperative.
To tolerate faults, one typically resorts to the replication of the components.

In the last decade, several important advances occurred in the development of intrusion-tolerant systems.
However, to the best of our knowledge, very few works proposed intrusion-tolerant protection devices, such as firewalls.
Performance reasons might explain this, as \gls{bft} replication protocols are usually associated with significant overheads and limited scalability.
Additionally, achieving complete transparency to the rest of the system can be challenging to reconcile with the objective of having fast message filtering under attack.


we propose a new protection system called \sieveq that mixes the firewall paradigm with a message queue service, with the goal of improving the state-of-the-art approaches under accidental failures and/or attacks.
The solution has a fault- and intrusion-tolerant architecture that applies filtering operations in two stages acting like a sieve.
The first stage, called \emph{pre-filtering}, performs lightweight checks, making it efficient to detect and discard malicious messages from external adversaries.
In particular, messages are only allowed to go through if they come from a pre-defined set of authenticated senders.
\gls{dos} traffic from external sources is immediately dropped, preventing those messages from overloading the next stage.
The second stage, named \emph{filtering}, enforces more refined application level policies, which can require the inspection of some message fields or need the enforcement of specific ordering rules.



Typical \gls{bft} protocols use one of the two following approaches to disseminate messages to the replicas: (1) traffic replicator before the replicas or (2) a leader is responsible to dessiminate the messages to the other replicas. 
The dissemination of a message to all replicas can be detrimental to the proper operation of the replicated service.
For example, a traffic replicator device (e.g., hub) can be placed at the entry of the system to transparently reproduce all messages~\cite{Sousa:2010,Roeder:2010}. 
The effect is an attack amplification caused by the replicator device.
Alternatively, a leader replica could receive the traffic and then disseminate the messages to the others~\cite{Amir:2011}.
The drawback is that the leader becomes a natural bottleneck, especially when under attack (instead of dispersing the attack load over all replicas).
%Then, new architectures can be designed to accommodate external attacks in a resourceful and resilient manner.

In \sieveq, we explore a different design for replicated protection devices, where we trade some transparency on senders and receivers for a more efficient and resilient firewall solution.
In particular, we propose an architecture in which critical services and devices can only be accessed through a message queue and implement the application-level filtering in this queue.
It is assumed that these services have a limited number of senders, which can be appropriately configured to ensure that only they are authorized to communicate through \sieveq.



The contributions of this work resulted in the following publications:

\begin{enumerate}
\item[5.] \textbf{An Intrusion-Tolerant Firewall Design for Protecting SIEM Systems}, Miguel Garcia, Nuno Neves, Alysson Bessani, in the \emph{Workshop on Systems Resilience in conjunction with the IEEE/IFIP International Conference on Dependable Systems and Networks, 2013}~\cite{Garcia:2013}.

\item[6.] \textbf{\sieveq: A Layered BFT Protection System for Critical Services}, Miguel Garcia, Nuno Neves, and Alysson Bessani, in \emph{IEEE Transactions on Dependable and Secure Computing, 2018}~\cite{Garcia:2016}.
\end{enumerate}



To conclude, the colaboration with Andr\'{e} Nogueira resulted in a (out of the scope of this thesis) work on \gls{scada} system enhanced with \gls{bft} techniques. 
We documented the challenges of building such system from a ``traditional'' non-\gls{bft} solution.
This effort resulted in a prototype that integrates the Eclipse NeoSCADA and the BFT-SMaRt open-source projects.
This solution could be managed by \system:


\begin{enumerate}

\item[7.] \textbf{On the Challenges of Building a BFT SCADA}, Andr\'{e} Nogueira, Miguel Garcia, Alysson Bessani, and Nuno Neves, in \emph{Proceedings of the International Conference on Dependable Systems and Networks, 2018 }~\cite{Nogueira:2018}.
\end{enumerate}


\subsection{Thesis Statement}
We summarize our findings in the following thesis statement:

\vspace{2mm}
\fbox{ \begin{minipage}{35em}
%\begin{center}
\emph{
It is possible to build dependable BFT replicated systems by minimizing the number of replicas' common vulnerabilities through software's diversity.
Additionally, it is possible to continuously manage these systems while monitoring OSINT data and deciding when replicas should be diversified and deploying the most dependable configurations.
}
%\end{center}
\end{minipage}
}





\section{Thesis Overview}
Detailed description of each Chapter
